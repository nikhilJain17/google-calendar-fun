<html>
    <head>
        <title>What's up</title>
        
        <script type="text/javascript">
            var CLIENT_ID = 
            var SCOPES = ["https://www.googleapis.com/auth/calendar.readonly"];
        
            // check authorization
             function checkAuth() {
                gapi.auth.authorize(
                {
                    'client_id': CLIENT_ID,
                    'scope': SCOPES.join(' '),
                    'immediate': true
                }, handleAuthResult);
            }
            
            // handle response from server
            // regarding oauth screen
            function handleAuthResult(authResult) {
                var authorizeDiv = document.getElementById('authorize-div');
                if (authResult && !authResult.error) {
                    // hide the auth gui and load the library
                    authorizeDiv.style.display = "none";
                    loadCalendarApi();
                }
                else {
                    // not oauth-ed
                    authorizeDiv.style.display = "inline";
                }
            }
            
            // initiate auth flow
            function handleAuthClick(event) {
                gapi.auth.authorize(
                    {client_id: CLIENT_ID, scope: SCOPES, immediate: false},
                    handleAuthResult);
                return false;
            }
            
            // load calender
            function loadCalendarApi() {
                gapi.client.load('calendar', 'v3', listUpcomingEvent);
            }
            
            // print summary of next 10 events on calendar
            // if no events, then other message is printed
            function listUpcomingEvents() {
                var request = gapi.client.calendar.events.list({
                    'calendarId': 'primary',
                    'timeMin': (new Date()).toISOString(),
                    'showDeleted': false,
                    'singleEvents':true,
                    'maxResults':10,
                    'orderBy':'startTime'
                });
                
                request.execute(function(resp) {
                    var events = resp.items;
                    appendPre('Upcoming Events:');
                    
                    if (events.length > 0) {
                        for (i = 0; i < events.length; i++) {
                            var event = events[i];
                            var when = event.start.dateTime;
                            if (!when) {
                                when = event.start.date;
                            }
                            appendPre(event.summary + ' (' + when + ')')
                        }
                    } 
                    else {
                        appendPre('No upcoming events found.');
                    }
                    
                });
            }
            
        function appendPre(message) {
        var pre = document.getElementById('output');
        var textContent = document.createTextNode(message + '\n');
        pre.appendChild(textContent);
      }

    </script>
    <script src="https://apis.google.com/js/client.js?onload=checkAuth">
    </script>
  </head>
  <body>
    <div id="authorize-div" style="display: none">
      <span>Authorize access to Google Calendar API</span>
      <!--Button for the user to click to initiate auth sequence -->
      <button id="authorize-button" onclick="handleAuthClick(event)">
        Authorize
      </button>
    </div>
    <pre id="output"></pre>
  </body>
</html>